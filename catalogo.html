<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cat√°logo - Julisalo</title>

    <!-- FIREBASE -->
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
    import { getFirestore, collection, getDocs, addDoc } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBG47Tct5Xc5mUTtF8jfnV-PTi1M6AEBE4",
        authDomain: "julisalo.firebaseapp.com",
        projectId: "julisalo",
        storageBucket: "julisalo.firebasestorage.app",
        messagingSenderId: "770420740812",
        appId: "1:770420740812:web:eaf66a57744e8a0ae2e869",
        measurementId: "G-BT8MHDK807"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    
    window.firebaseDB = db;
    window.firebaseFunctions = { collection, getDocs, addDoc }; // ‚Üê addDoc AGREGADO
</script>
    <link rel="stylesheet" href="catalogo.css">
</head>

<body>
    <!-- Encabezado -->
    <header>
        <div class="container">
            <div class="header-content">
                <a href="index.html" class="back-btn">‚Üê Volver al Inicio</a>
                <a href="registro.html" class="login-btn">Iniciar Sesi√≥n</a>
                <div class="cart-icon" onclick="openCart()">
                    üõí <span id="cartCount">0</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Logo -->
    <section class="logo-section">
        <div class="container">
            <div class="logo">
                <img src="https://i.postimg.cc/NjdrTZQv/Whats-App-Image-2025-11-16-at-12-58-11-PM-removebg-preview.png"
                    alt="Logo Mi Local">
            </div>
        </div>
    </section>

    <!-- T√≠tulo -->
    <section class="catalog-title-section">
        <div class="container">
            <h1 class="catalog-title">Nuestro Cat√°logo</h1>
        </div>
    </section>

    <!-- Filtros -->
    <section class="filters-section">
        <div class="container">
            <div class="filters">
                <button class="filter-btn active" onclick="filterProducts('todos')">Todos</button>
                <button class="filter-btn" onclick="filterProducts('cacharreria')">Cacharrer√≠a</button>
                <button class="filter-btn" onclick="filterProducts('telefonos')">Tel√©fonos</button>
                <button class="filter-btn" onclick="filterProducts('accesorios')">Accesorios</button>
                <button class="filter-btn" onclick="filterProducts('ofertas')">Papeleria</button>
            </div>
        </div>
        <!-- BARRA DE B√öSQUEDA NUEVA -->
        <div class="search-container" style="margin-top: 20px; display: flex; justify-content: center;">
            <div style="position: relative; width: 100%; max-width: 400px;">
                <input type="text" id="searchInput" placeholder="üîç Buscar productos..." 
                       style="width: 100%; padding: 12px 20px; border: 2px solid #5C0667; border-radius: 25px; font-size: 16px; outline: none;">
                <button onclick="clearSearch()" 
                        style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; font-size: 18px; cursor: pointer; color: #5C0667;">
                    ‚úï
                </button>
            </div>
        </div>
    </div>
    </section>

    <!-- Grid de productos -->
    <section class="products-section">
        <div class="container">
            <div id="loading" class="loading">üîÑ Cargando productos...</div>
            <div id="noProducts" class="no-products" style="display: none;">üì≠ No hay productos disponibles</div>
            <div class="products-grid" id="productsGrid">
                <!-- Los productos se cargar√°n aqu√≠ desde Firebase -->
            </div>
        </div>
    </section>
    <div id="cartModal" class="modal">
        <div class="modal-content cart-modal">
            <h3>üõí Tu Carrito</h3>
            <div id="cartItems"></div>
            <div class="cart-total">
                Total: $<span id="cartTotal">0.00</span>
            </div>
            
            <div class="delivery-type">
                <label>
                    <input type="radio" name="deliveryType" value="local" checked> 
                    Recoger en local
                </label>
                <label>
                    <input type="radio" name="deliveryType" value="domicilio">
                    Env√≠o a domicilio
                </label>
            </div>
            
            <div id="addressField" style="display: none;">
                <input type="text" id="customerName" placeholder="Nombre del cliente" style="width: 100%; padding: 8px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 5px;">
                <input type="text" id="deliveryAddress" placeholder="Direcci√≥n de entrega" style="width: 100%; padding: 8px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 5px;">
                <input type="tel" id="deliveryPhone" placeholder="Tel√©fono" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
            </div>
            
            <div class="cart-actions">
                <button class="btn-cancel" onclick="closeCart()">Seguir comprando</button>
                <button class="btn-order" onclick="placeOrder()">Realizar Pedido</button>
            </div>
        </div>
    </div>
    <script src="carrito.js"></script>
    <script>
        let allProducts = [];

        // Cargar productos al iniciar
        document.addEventListener('DOMContentLoaded', function () {
            loadProductsFromFirebase();
        });

        // CARGAR productos desde Firebase
        async function loadProductsFromFirebase() {
            try {
                const db = window.firebaseDB;
                const { collection, getDocs } = window.firebaseFunctions;

                const querySnapshot = await getDocs(collection(db, "productos"));
                allProducts = [];

                querySnapshot.forEach((doc) => {
                    allProducts.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });

                // Ocultar loading
                document.getElementById('loading').style.display = 'none';

                if (allProducts.length === 0) {
                    document.getElementById('noProducts').style.display = 'block';
                } else {
                    renderProducts(allProducts);
                }

            } catch (error) {
                console.error("Error cargando productos:", error);
                document.getElementById('loading').innerHTML = '‚ùå Error al cargar productos';
            }
        }

        // Mostrar productos en pantalla
        function renderProducts(products) {
    const grid = document.getElementById('productsGrid');
    const noProducts = document.getElementById('noProducts');
    
    grid.innerHTML = '';
    
    if (products.length === 0) {
        noProducts.style.display = 'block';
        noProducts.innerHTML = 'üì≠ No hay productos disponibles en esta categor√≠a';
        return;
    }
    
    noProducts.style.display = 'none';
    
    products.forEach(product => {
        const productCard = document.createElement('div');
        productCard.className = 'product-card';
        productCard.innerHTML = `
            <div class="product-image">
                ${product.imagen ? 
                    `<img src="${product.imagen}" alt="${product.nombre}" onerror="this.style.display='none'; this.parentNode.innerHTML='üì∑ Sin imagen';">` : 
                    'üì∑ Sin imagen'
                }
            </div>
            <div class="product-info">
                <h3 class="product-name">${product.nombre}</h3>
                <p class="product-description">${product.descripcion}</p>
                ${product.categoria ? `<div class="product-category" style="background: #5C0667; color: white; padding: 2px 8px; border-radius: 12px; font-size: 12px; display: inline-block; margin: 5px 0;">${product.categoria}</div>` : ''}
                <div class="product-price">$${product.precio.toFixed(2)}</div>
                <div class="product-stock">${product.stock > 0 ? '‚úÖ Disponible' : '‚ùå Agotado'}</div>
                ${product.stock > 0 ? 
                    `<button class="add-to-cart-btn" onclick="addToCart(${JSON.stringify(product).replace(/"/g, '&quot;')})">
                        Agregar al Carrito
                    </button>` : 
                    '<button class="add-to-cart-btn disabled" disabled>Agotado</button>'
                }
            </div>
        `;
        grid.appendChild(productCard);
    });
}

        // Filtrar productos por categor√≠a
function filterProducts(category) {
    // Actualizar botones activos
    document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    event.target.classList.add('active');
    
    if (category === 'todos') {
        renderProducts(allProducts);
    } else {
        // Filtrar por categor√≠a exacta
        const filtered = allProducts.filter(product => 
            product.categoria && product.categoria.toLowerCase() === category.toLowerCase()
        );
        renderProducts(filtered);
    }
}

    // Funci√≥n de b√∫squeda en tiempo real
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('searchInput');
    if (searchInput) {
        searchInput.addEventListener('input', function() {
            searchProducts(this.value);
        });
    }
});

// Funci√≥n para buscar productos
function searchProducts(searchTerm) {
    if (!searchTerm || searchTerm.trim() === '') {
        // Si no hay t√©rmino de b√∫squeda, mostrar todos los productos
        const activeFilter = document.querySelector('.filter-btn.active');
        if (activeFilter) {
            const category = activeFilter.textContent.toLowerCase();
            filterProductsByCategory(category);
        } else {
            renderProducts(allProducts);
        }
        return;
    }
    
    const term = searchTerm.toLowerCase().trim();
    const filtered = allProducts.filter(product => 
        product.nombre.toLowerCase().includes(term) || 
        product.descripcion.toLowerCase().includes(term) ||
        (product.categoria && product.categoria.toLowerCase().includes(term))
    );
    
    renderProducts(filtered);
}

// Funci√≥n para limpiar b√∫squeda
function clearSearch() {
    const searchInput = document.getElementById('searchInput');
    if (searchInput) {
        searchInput.value = '';
        searchProducts('');
    }
}

// Funci√≥n auxiliar para filtrar por categor√≠a (usada en la b√∫squeda)
function filterProductsByCategory(category) {
    if (category === 'todos') {
        renderProducts(allProducts);
    } else {
        const filtered = allProducts.filter(product => 
            product.categoria && product.categoria.toLowerCase() === category
        );
        renderProducts(filtered);
    }
}
        // Recargar productos cada 30 segundos (opcional)
        setInterval(() => {
            loadProductsFromFirebase();
        }, 30000);
    </script>
    <footer style="
    background: #5C0667;
    color: #dfe6e9;
    padding: 40px 20px;
    font-family: Arial, sans-serif;
  ">
        <div style="max-width: 1200px; margin: 0 auto; text-align: center;">

            <!-- Encabezado del Footer -->
            <div style="margin-bottom: 25px;">
                <h2 style="color: #e17055; margin: 0 0 10px 0; font-size: 32px;">
                    LOCAL JULISALO
                </h2>
                <p style="margin: 0; font-size: 18px; color: #81ecec;">
                    M√°s cerca de T√≠
                </p>
            </div>

            <!-- Informaci√≥n en columnas -->
            <div style="display: flex; justify-content: center; gap: 50px; flex-wrap: wrap; margin: 30px 0;">
                <div style="text-align: left;">
                    <h4 style="color: #fd79a8; margin: 0 0 15px 0;">üìç Nuestro Local</h4>
                    <p style="margin: 5px 0;">‚úÖ Productos de calidad</p>
                    <p style="margin: 5px 0;">‚úÖ Atenci√≥n personalizada</p>
                    <p style="margin: 5px 0;">‚úÖ Precios competitivos</p>
                </div>

                <div style="text-align: left;">
                    <h4 style="color: #fd79a8; margin: 0 0 15px 0;">üìû Cont√°ctanos</h4>
                    <p style="margin: 5px 0;">üè™ Vis√≠tanos Cuando Puedas</p>
                    <p style="margin: 5px 0;">‚≠ê Cientos de Clientes Felices</p>
                </div>
            </div>
            <!-- Copyright -->
            <div style="margin-top: 25px; padding-top: 20px; border-top: 1px solid #636e72;">
                <p style="margin: 0; font-size: 14px;">
                    <strong>Local Julisalo</strong> ‚Ä¢ Desarrollado por <strong style="color: #E1306C;"> IG:
                        @T4po.0</strong>
                </p>
                <p style="margin: 5px 0 0 0; font-size: 12px; color: #b2bec3;">
                    &copy; 2025 - Sencillez con Facilidad
                </p>
            </div>
        </div>
    </footer>
</body>

</html>